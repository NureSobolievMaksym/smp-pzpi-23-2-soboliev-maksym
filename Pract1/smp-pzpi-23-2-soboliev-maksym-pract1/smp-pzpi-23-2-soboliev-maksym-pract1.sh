#!/bin/bash

#==============================================================================
# Функція для друку одного рядка з відступом
# Аргументи:
#   $1 - кількість пробілів для відступу зліва
#   $2 - рядок, який потрібно надрукувати
#==============================================================================
print_row() {
  local indent_spaces=$1
  local content=$2

  # Цикл for ((...)) для друку відступу
  for ((i = 0; i < indent_spaces; i++)); do
    echo -n " "
  done

  echo "$content"
}

# --- Головна частина скрипта ---

# 1. Перевірка кількості аргументів
if [ "$#" -ne 2 ]; then
  echo "Помилка: потрібно вказати два параметри: <висота> та <ширина>." >&2
  exit 1
fi

TOTAL_HEIGHT=$1
SNOW_WIDTH=$2

# 2. Валідація аргументів
# Перевіряємо, чи є аргументи додатніми цілими числами.
if ! [[ "$TOTAL_HEIGHT" =~ ^[1-9][0-9]*$ && "$SNOW_WIDTH" =~ ^[1-9][0-9]*$ ]]; then
    echo "Помилка: висота та ширина повинні бути додатніми цілими числами." >&2
    exit 2
fi

# 3. Розрахунок та перевірка можливості побудови ялинки
# Висота для гілок = Загальна висота - висота стовбура (2) - висота снігу (1)
BRANCHES_HEIGHT=$((TOTAL_HEIGHT - 3))
# Максимальна ширина гілок = Ширина снігу - 2
BRANCH_MAX_WIDTH=$((SNOW_WIDTH - 2))

# Перевіряємо, чи достатньо висоти та ширини
if [ "$BRANCHES_HEIGHT" -lt 2 ] || [ "$BRANCH_MAX_WIDTH" -lt 1 ]; then
    echo "Помилка: за вказаними значеннями зобразити ялинку неможливо (замалі розміри)." >&2
    exit 3
fi

# Висота одного ярусу (округлення в меншу сторону через цілочисельну арифметику)
TIER_HEIGHT=$((BRANCHES_HEIGHT / 2))

# Ширина основи трикутника висотою TIER_HEIGHT розраховується як: 1 + (TIER_HEIGHT - 1) * 2
# Ця розрахункова ширина повинна збігатися з дозволеною шириною гілок
CALCULATED_WIDTH=$((1 + (TIER_HEIGHT - 1) * 2))

if [ "$BRANCH_MAX_WIDTH" -ne "$CALCULATED_WIDTH" ]; then
    echo "Помилка: за вказаними значеннями зобразити симетричну ялинку неможливо." >&2
    echo "Спробуйте інші значення. Наприклад, висота 13 та ширина 11." >&2
    exit 4
fi

# --- Малювання ялинки ---

## Гілки ялинки
# Цикл `for ... in` для малювання двох ярусів
for tier in 1 2; do
  row_num=1
  # Цикл `while` для ітерації по рядках одного ярусу
  while [ "$row_num" -le "$TIER_HEIGHT" ]; do
    
    # Визначаємо символ для поточного рядка
    symbol='*'
    if [ $((row_num % 2)) -eq 0 ]; then
        symbol='#'
    fi

    # Розраховуємо кількість символів у поточному рядку
    num_chars=$((1 + (row_num - 1) * 2))
    
    # Формуємо рядок гілок за допомогою циклу `until`
    line_content=""
    count=0
    until [ "$count" -ge "$num_chars" ]; do
      line_content+=$symbol
      count=$((count + 1))
    done

    # Розраховуємо відступ та друкуємо рядок
    indent=$(((SNOW_WIDTH - num_chars) / 2))
    print_row "$indent" "$line_content"

    row_num=$((row_num + 1))
  done
done

# --- Стовбур ялинки ---
# Малюємо стовбур фіксованої висоти (2 рядки) та ширини (3 символи)
TRUNK_WIDTH=3
TRUNK_HEIGHT=3
TRUNK_INDENT=$(((SNOW_WIDTH - TRUNK_WIDTH) / 2))

for ((i = 0; i < TRUNK_HEIGHT; i++)); do
  print_row "$TRUNK_INDENT" "###"
done

# --- Шар снігу ---
# Малюємо сніг фіксованої товщини (1 рядок)
snow_line=""
for ((i = 0; i < SNOW_WIDTH; i++)); do
  snow_line+="*"
done
echo "$snow_line"

exit 0